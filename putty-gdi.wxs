<?xml version="1.0" encoding="utf-8"?>
<!--
    # This comment is generated by WixEdit, the specific commandline
    # arguments for the WiX Toolset are stored here.

    candleArgs: "<projectfile>" -out "<projectname>.wixobj" -fips <extensions>
    lightArgs: "<projectname>.wixobj" -out "<projectname>.msi" <extensions> -cultures:ja-jp
-->
<?define SourceDir      = "putty-gdi-20150816" ?>
<?define ProductVersion = "0.64.0" ?>
<?if $(sys.BUILDARCH) = "x86" ?>
   <?define ExeSourceDir    = "$(var.SourceDir)" ?>
   <?define SystemDir       = "SystemFolder" ?>
   <?define ProgramFilesDir = "ProgramFilesFolder" ?>
   <?define Win64           = "no" ?>
<?elseif $(sys.BUILDARCH) = "x64" ?>
   <?define ExeSourceDir    = "$(var.SourceDir)\x64" ?>
   <?define SystemDir       = "System64Folder" ?>
   <?define ProgramFilesDir = "ProgramFiles64Folder" ?>
   <?define Win64           = "yes" ?>
<?endif?>
<?define ProductId   = "A32541A5-1200-11E5-AE23-D89D672E67E0" ?>
<?define UpgradeCode = "E428B75E-803A-4F59-ACCE-9CFDC890D806" ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
    <Product Id="$(var.ProductId)" Name="PuTTY 0.65+ICE IV" Version="$(var.ProductVersion)" Manufacturer="Simon Tatham and ICE" Language="1041" Codepage="932" UpgradeCode="$(var.UpgradeCode)">
        <Package Description="PuTTY 0.65 をベースとして、 PuTTY 0.60 ごった煮版 2007年8月6日版 に諸々の機能を追加しました。" Comments="ICE IV+PuTTYインストーラ" InstallerVersion="300" Compressed="yes" SummaryCodepage="932" />
        <Media Id="1" Cabinet="simple.cab" EmbedCab="yes" />
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="$(var.ProgramFilesDir)" Name="Program Files">
                <Directory Id="INSTALLDIR" Name="PuTTY">
                    <Component Id="LICENCE" DiskId="1" Guid="C5918B13-7161-4247-B2A4-33B0D0E9CAE0">
                        <File Id="LICENCE" Name="LICENCE" Source="$(var.SourceDir)\LICENCE" />
                    </Component>
                    <Component Id="PAGEANT.EXE" DiskId="1" Guid="DAFD854E-A5E3-49F3-9729-734561E77D63" Win64="$(var.Win64)">
                        <File Id="PAGEANT.EXE" Name="pageant.exe" Source="$(var.ExeSourceDir)\pageant.exe" />
                        <ProgId Id="SSH_PRIVATE_KEY" Description="SSH Private Key">
                            <Extension Id="ppk">
                                <Verb Id="Open" Argument="&quot;%1&quot;" TargetFile="PAGEANT.EXE" />
                            </Extension>
                        </ProgId>
                    </Component>
                    <Component Id="PAGEANT.LNG" DiskId="1" Guid="B7EF1E47-41CB-4BB7-87EE-0F2CACB580DD">
                        <File Id="PAGEANT.LNG" Name="pageant.lng" Source="$(var.SourceDir)\ja-JP\pageant.lng" />
                    </Component>
                    <Component Id="PFWD.EXE" DiskId="1" Guid="B4E5252C-B7A3-420A-8BD9-22684C6B2A24" Win64="$(var.Win64)">
                        <File Id="PFWD.EXE" Name="pfwd.exe" Source="$(var.ExeSourceDir)\pfwd.exe" />
                    </Component>
                    <Component Id="PFWD.LNG" DiskId="1" Guid="302626B3-1C68-4A49-957D-DBB242F11A4C">
                        <File Id="PFWD.LNG" Name="pfwd.lng" Source="$(var.SourceDir)\ja-JP\pfwd.lng" />
                    </Component>
                    <Component Id="PLINK.EXE" DiskId="1" Guid="FE01EACF-1A7F-4C89-9822-64157AD6D77A" Win64="$(var.Win64)">
                        <File Id="PLINK.EXE" Name="plink.exe" Source="$(var.ExeSourceDir)\plink.exe" />
                    </Component>
                    <Component Id="PLINKW.EXE" DiskId="1" Guid="2988EE7F-EF17-4167-A76E-66BE48D78B04" Win64="$(var.Win64)">
                        <File Id="PLINKW.EXE" Name="plinkw.exe" Source="$(var.ExeSourceDir)\plinkw.exe" />
                    </Component>
                    <Component Id="PLINKW.LNG" DiskId="1" Guid="2FDC7C00-D42D-43E5-82A5-9CE0B7FD8E48">
                        <File Id="PLINKW.LNG" Name="plinkw.lng" Source="$(var.SourceDir)\ja-JP\plinkw.lng" />
                    </Component>
                    <Component Id="PSCP.EXE" DiskId="1" Guid="7F76BE1B-A234-4F5F-8044-669B58F85AB2" Win64="$(var.Win64)">
                        <File Id="PSCP.EXE" Name="pscp.exe" Source="$(var.ExeSourceDir)\pscp.exe" />
                    </Component>
                    <Component Id="PSFTP.EXE" DiskId="1" Guid="68FE3827-6F7A-442B-A4B4-3631038A66FA" Win64="$(var.Win64)">
                        <File Id="PSFTP.EXE" Name="psftp.exe" Source="$(var.ExeSourceDir)\psftp.exe" />
                    </Component>
                    <Component Id="PUTTY.CHM" DiskId="1" Guid="79DD055D-C5DE-494C-8DD2-5D221FFF5D82">
                        <File Id="PUTTY.CHM" Name="putty.chm" Source="$(var.SourceDir)\putty.chm" />
                    </Component>
                    <Component Id="PUTTY.CNT" DiskId="1" Guid="9174A39D-4860-4668-BA9C-6920321AFBD2">
                        <File Id="PUTTY.CNT" Name="putty.cnt" Source="$(var.SourceDir)\putty.cnt" />
                    </Component>
                    <Component Id="PUTTY.EXE" DiskId="1" Guid="3C45CE1D-9130-4B1E-A984-D2BF70A46C8D" Win64="$(var.Win64)">
                        <File Id="PUTTY.EXE" Name="putty.exe" Source="$(var.ExeSourceDir)\putty.exe" KeyPath="yes">
                            <Shortcut Id="desktopShortcut" Directory="DesktopFolder" Name="PuTTY" WorkingDirectory="INSTALLDIR" Advertise="yes" Icon="DesktopIcon.exe" IconIndex="0" />
                        </File>
                    </Component>
                    <Component Id="PUTTY.HLP" DiskId="1" Guid="F8A154CB-D181-4455-9FF3-DAB36D8E1948">
                        <File Id="PUTTY.HLP" Name="putty.hlp" Source="$(var.SourceDir)\putty.hlp" />
                    </Component>
                    <Component Id="PUTTY.INI" DiskId="1" Guid="DBE7634D-F030-4EE8-A2D7-C6A7916F8925">
                        <File Id="PUTTY.INI" Name="putty.ini" Source="$(var.SourceDir)\putty.ini" />
                        <IniFile Id="PUTTY.INI" Directory="INSTALLDIR" Name="putty.ini" Action="createLine" Section="Generic" Key="UseIniFile" Value="1" />
                    </Component>
                    <Component Id="PUTTY.LNG" DiskId="1" Guid="37F7ADD9-AD98-45A6-AF62-920A4A4522FE">
                        <File Id="PUTTY.LNG" Name="putty.lng" Source="$(var.SourceDir)\ja-JP\putty.lng" />
                    </Component>
                    <Component Id="PUTTYGEN.EXE" DiskId="1" Guid="A697BEF0-CCC6-44E3-9E58-CA6D88D90AAC" Win64="$(var.Win64)">
                        <File Id="PUTTYGEN.EXE" Name="puttygen.exe" Source="$(var.ExeSourceDir)\puttygen.exe" />
                    </Component>
                    <Component Id="PUTTYGEN.LNG" DiskId="1" Guid="515AD967-6721-48F8-85CE-AD8035A49584">
                        <File Id="PUTTYGEN.LNG" Name="puttygen.lng" Source="$(var.SourceDir)\ja-JP\puttygen.lng" />
                    </Component>
                    <Component Id="PUTTYTEL.EXE" DiskId="1" Guid="31C83B04-FFC7-4873-A222-B00466E9F909" Win64="$(var.Win64)">
                        <File Id="PUTTYTEL.EXE" Name="puttytel.exe" Source="$(var.ExeSourceDir)\puttytel.exe" />
                    </Component>
                    <Component Id="PUTTYTEL.LNG" DiskId="1" Guid="EF95BDD6-15E3-4792-9BAD-ACEF8704E8AF">
                        <File Id="PUTTYTEL.LNG" Name="puttytel.lng" Source="$(var.SourceDir)\ja-JP\puttytel.lng" />
                    </Component>
                    <Component Id="README" DiskId="1" Guid="5D96EF51-911F-4D17-A4C0-817C7240CF18">
                        <File Id="README" Name="README" Source="$(var.SourceDir)\README" />
                    </Component>
                    <Directory Id="INI" Name="ini">
                        <Component Id="PFWD.INI_SAMPLE" DiskId="1" Guid="16DCE17B-D07B-411C-B8FE-C9D863717195">
                            <File Id="PFWD.INI_SAMPLE" Name="pfwd.ini" Source="$(var.SourceDir)\ini\pfwd.ini" />
                        </Component>
                        <Component Id="PUTTY.INI_SAMPLE" DiskId="1" Guid="91081C15-5DBE-4E0E-B4CB-DD7861CCEC5F">
                            <File Id="PUTTY.INI_SAMPLE" Name="putty.ini" Source="$(var.SourceDir)\ini\putty.ini" />
                        </Component>
                    </Directory>
                    <Directory Id="DIFF" Name="patch">
                        <Component Id="GDI.DIFF" DiskId="1" Guid="C59B2646-C9F8-4DBC-90C0-941334C30D02">
                            <File Id="GDI.DIFF" Name="gdi.diff" Source="$(var.SourceDir)\patch\gdi.diff" />
                        </Component>
                    </Directory>
                </Directory>
            </Directory>
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ProgramMenuDir" Name="PuTTY">
                    <Component Id="StartMenuShortcuts" Guid="BE43A6AE-BA36-4DE1-8CF1-810DC116D09A">
                        <RemoveFolder Id="ProgramMenuDir" On="uninstall" />
                        <RegistryValue Root="HKCU" Key="Software\[Manufacturer]\[ProductName]" Type="string" Value="" />
                        <Shortcut Id="UninstallProduct" Name="アンインストール" Description="ICE IV+PuTTYのアンインストール" Target="[$(var.SystemDir)]msiexec.exe" Arguments="/x [ProductCode]" />
                        <Shortcut Id="PuTTY_StartMenuShortcut" Name="PuTTY" Description="SSH, Telnet and Rlogin client" Target="[INSTALLDIR]putty.exe" WorkingDirectory="INSTALLDIR" />
                        <Shortcut Id="PuTTYGen_StartMenuShortcut" Name="PuTTYGen" Description="SSH RSA/DSA/ECDSA Key Generator" Target="[INSTALLDIR]puttygen.exe" WorkingDirectory="DesktopFolder" />
                        <Shortcut Id="Pageant_StartMenuShortcut" Name="Pageant" Description="SSH Key Agent" Target="[INSTALLDIR]pageant.exe" WorkingDirectory="DesktopFolder" />
                        <util:InternetShortcut Id="WebsiteShortcut" Name="ICE IV+PuTTY ホームページ" Target="http://ice.hotmint.com/putty/" />
                    </Component>
                </Directory>
            </Directory>
            <Directory Id="DesktopFolder" />
        </Directory>
        <Feature Id="DefaultFeature" Title="Main Feature" Level="1">
            <ComponentRef Id="LICENCE" />
            <ComponentRef Id="PAGEANT.EXE" />
            <ComponentRef Id="PAGEANT.LNG" />
            <ComponentRef Id="PFWD.EXE" />
            <ComponentRef Id="PFWD.LNG" />
            <ComponentRef Id="PLINK.EXE" />
            <ComponentRef Id="PLINKW.EXE" />
            <ComponentRef Id="PLINKW.LNG" />
            <ComponentRef Id="PSCP.EXE" />
            <ComponentRef Id="PSFTP.EXE" />
            <ComponentRef Id="PUTTY.CHM" />
            <ComponentRef Id="PUTTY.CNT" />
            <ComponentRef Id="PUTTY.EXE" />
            <ComponentRef Id="PUTTY.HLP" />
            <ComponentRef Id="PUTTY.INI" />
            <ComponentRef Id="PUTTY.LNG" />
            <ComponentRef Id="PUTTYGEN.EXE" />
            <ComponentRef Id="PUTTYGEN.LNG" />
            <ComponentRef Id="PUTTYTEL.EXE" />
            <ComponentRef Id="PUTTYTEL.LNG" />
            <ComponentRef Id="README" />
            <ComponentRef Id="PFWD.INI_SAMPLE" />
            <ComponentRef Id="PUTTY.INI_SAMPLE" />
            <ComponentRef Id="GDI.DIFF" />
            <ComponentRef Id="StartMenuShortcuts" />
        </Feature>
        <Icon Id="DesktopIcon.exe" SourceFile="$(var.ExeSourceDir)\putty.exe" />
        <UI Id="WixUI_InstallDir">
            <TextStyle Id="WixUI_Font_Normal" FaceName="Tahoma" Size="8" />
            <TextStyle Id="WixUI_Font_Bigger" FaceName="Tahoma" Size="12" />
            <TextStyle Id="WixUI_Font_Title" FaceName="Tahoma" Size="9" Bold="yes" />
            <Property Id="DefaultUIFont" Value="WixUI_Font_Normal" />
            <Property Id="WixUI_Mode" Value="InstallDir" />
            <DialogRef Id="BrowseDlg" />
            <DialogRef Id="DiskCostDlg" />
            <DialogRef Id="ErrorDlg" />
            <DialogRef Id="FatalError" />
            <DialogRef Id="FilesInUse" />
            <DialogRef Id="MsiRMFilesInUse" />
            <DialogRef Id="PrepareDlg" />
            <DialogRef Id="ProgressDlg" />
            <DialogRef Id="ResumeDlg" />
            <DialogRef Id="UserExit" />
            <Publish Dialog="BrowseDlg" Control="OK" Event="DoAction" Value="WixUIValidatePath" Order="3">1</Publish>
            <Publish Dialog="BrowseDlg" Control="OK" Event="SpawnDialog" Value="InvalidDirDlg" Order="4"><![CDATA[WIXUI_INSTALLDIR_VALID<>"1"]]></Publish>
            <Publish Dialog="ExitDialog" Control="Finish" Event="EndDialog" Value="Return" Order="999">1</Publish>
            <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="InstallDirDlg">NOT Installed</Publish>
            <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="VerifyReadyDlg">Installed AND PATCH</Publish>
            <Publish Dialog="InstallDirDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg">1</Publish>
            <Publish Dialog="InstallDirDlg" Control="Next" Event="SetTargetPath" Value="[WIXUI_INSTALLDIR]" Order="1">1</Publish>
            <Publish Dialog="InstallDirDlg" Control="Next" Event="DoAction" Value="WixUIValidatePath" Order="2">NOT WIXUI_DONTVALIDATEPATH</Publish>
            <Publish Dialog="InstallDirDlg" Control="Next" Event="SpawnDialog" Value="InvalidDirDlg" Order="3"><![CDATA[NOT WIXUI_DONTVALIDATEPATH AND WIXUI_INSTALLDIR_VALID<>"1"]]></Publish>
            <Publish Dialog="InstallDirDlg" Control="Next" Event="NewDialog" Value="VerifyReadyDlg" Order="4">WIXUI_DONTVALIDATEPATH OR WIXUI_INSTALLDIR_VALID="1"</Publish>
            <Publish Dialog="InstallDirDlg" Control="ChangeFolder" Property="_BrowseProperty" Value="[WIXUI_INSTALLDIR]" Order="1">1</Publish>
            <Publish Dialog="InstallDirDlg" Control="ChangeFolder" Event="SpawnDialog" Value="BrowseDlg" Order="2">1</Publish>
            <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="InstallDirDlg" Order="1">NOT Installed</Publish>
            <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="MaintenanceTypeDlg" Order="2">Installed AND NOT PATCH</Publish>
            <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" Order="2">Installed AND PATCH</Publish>
            <Publish Dialog="MaintenanceWelcomeDlg" Control="Next" Event="NewDialog" Value="MaintenanceTypeDlg">1</Publish>
            <Publish Dialog="MaintenanceTypeDlg" Control="RepairButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
            <Publish Dialog="MaintenanceTypeDlg" Control="RemoveButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
            <Publish Dialog="MaintenanceTypeDlg" Control="Back" Event="NewDialog" Value="MaintenanceWelcomeDlg">1</Publish>
            <Property Id="ARPNOMODIFY" Value="1" />
        </UI>
        <UIRef Id="WixUI_Common" />
        <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />

        <Upgrade Id="$(var.UpgradeCode)">
            <UpgradeVersion OnlyDetect="no"  IncludeMinimum="no"  Minimum="0.0.0" Maximum="$(var.ProductVersion)" Property="PREVIOUSVERSIONSINSTALLED" />
            <UpgradeVersion OnlyDetect="yes" IncludeMinimum="yes" Minimum="$(var.ProductVersion)" Property="NEWPRODUCTFOUND" />
        </Upgrade>
        <InstallExecuteSequence>
            <RemoveExistingProducts After="InstallInitialize"/>
        </InstallExecuteSequence>
        <CustomActionRef Id="WixExitEarlyWithSuccess" />
   </Product>
</Wix>